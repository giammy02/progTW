{% extends "playPadel/base.html" %}

{% load static %}

{% load crispy_forms_tags %}
{% load crispy_forms_filters %}

{% block title %} PlayPadel - {{ object.nome }} {% endblock %}

{% block content %}

    <section class="section py-1" style="min-height: 83vh;">
        <div class="container mt-5">
            <div class="row align-items-center">
                <div class="col-md-2 text-left">
                    <a href="{% url 'website:website:impianti' %}" class="btn btn-outline-dark" data-toggle="tooltip" data-placement="top" title="Torna alla lista degli impianti">
                        <i class="bi bi-arrow-left"></i>
                    </a>
                </div>
                <div class="col-md-8 text-center">
                    <h1 class="display-4 mb-0">Impianto {{ object.nome }}</h1>
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="row mt-4">
                <div class="col-md-6">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <i class="bi bi-geo-alt-fill"></i>
                            <strong>Posizione:</strong> {{ object.posizione }}
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-clock-fill"></i>
                            <strong>Orari di apertura:</strong> {{ object.orari }}
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-cash"></i>
                            <strong>Prezzi:</strong> A partire da {{ object.prezzi }}€ l'ora
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-telephone-fill"></i>
                            <strong>Contatti:</strong> {{ object.contatti }}
                        </li>
                        <li class="list-group-item">
                            <i class="bi bi-info-circle-fill"></i>
                            <strong>Servizi offerti:</strong> {{ object.caratteristiche }}
                        </li>
                        <li class="list-group-item">
                            <div>
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-person-badge-fill"></i>
                                    <h5 class="ml-3 mt-2">Informazioni sul gestore dell'impianto</h5>
                                </div>
                                <div class="d-flex align-items-center mt-3">
                                    <img src="{% static 'img' %}/{{ object.gestore.foto }}" class="rounded-circle ml-3 border border-info" alt="Foto del gestore" style="width: 100px; height: 100px;">
                                    <p class="ml-5 mb-0"><strong>{{ object.gestore.first_name }} {{ object.gestore.last_name }}</strong></p>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6 text-center">
                    <img src="{% static 'img' %}/{{ object.foto }}" class="img-fluid rounded" alt="Foto dell'impianto" style="max-height: 450px">
                </div>
            </div>
            {% if news %}
                <hr class="hr" />
                <div class="d-flex align-items-center mt-4 mb-2">
                    <i class="bi bi-newspaper mr-2" style="font-size: 1.5rem"></i>
                    <h2 class="mb-0">News dell'impianto</h2>
                </div>
                <div id="textCarousel" class="carousel slide" data-ride="carousel" style="min-height: 150px">
                    <div class="carousel-inner">
                        {% for n in news %}
                            {% if forloop.first %}
                                <div class="carousel-item active" style="min-height: 110px">
                                    <div class="d-flex flex-column justify-content-center align-items-center mt-2 w-75 mx-auto">
                                        <h5 class="text-center">{{ n.titolo }}</h5>
                                        <p class="text-center mb-0">{{ n.descrizione }}</p>
                                        <small class="text-muted mt-2">{{ n.data }}</small>
                                    </div>
                                </div>
                            {% else %}
                                <div class="carousel-item" style="min-height: 110px">
                                    <div class="d-flex flex-column justify-content-center align-items-center mt-2 w-75 mx-auto">
                                        <h5 class="text-center">{{ n.titolo }}</h5>
                                        <p class="text-center mb-0">{{ n.descrizione }}</p>
                                        <small class="text-muted mt-2">{{ n.data }}</small>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <a class="carousel-control-prev" href="#textCarousel" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#textCarousel" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            {% endif %}
            <hr class="hr" />
            <form method="post" action="{% url 'website:website:conferma_prenotazione' slug=object.slug %}">
                {% csrf_token %}
                <div class="row my-4">
                    <div class="col-md-5 d-flex align-items-center">
                        <i class="bi bi-list-ol mr-2" style="font-size: 1.5rem"></i>
                        <h2>Lista campi</h2>
                    </div>
                    <div class="col-md-4 text-right form-inline mb-0">
                        <label for="selectDate" class="mr-2"><strong>Data prenotazione</strong></label>
                        {{ form.data|as_crispy_field }}
                    </div>
                    <div class="col-md-3 mb-0 form-inline d-flex justify-content-end">
                        <label for="selectDuration" class="mr-2"><strong>Durata</strong></label>
                        {{ form.durata|as_crispy_field }}
                    </div>
                </div>
                <div id="accordion">
                    {% for i in campo %}
                        <div class="card bg-transparent my-2" style="border: 1px solid #ddd;">
                            <a class="card-header bg-transparent" style="cursor: pointer" data-toggle="collapse" data-target="#collapse{{ forloop.counter }}" aria-expanded="false">
                                <span class="title" style="font-size: 17px; color: #000">Campo {{ i.numero }} - {{ i.tipologia }}</span>
                                <span class="accicon float-right" style="font-size: 20px; width: 1.2em;"><i class="bi bi-caret-down-fill"></i></span>
                            </a>
                            <div id="collapse{{ forloop.counter }}" class="collapse hidden" data-parent="#accordion">
                                <div class="card-body" style="border-top: 1px solid #ddd;">
                                    <div class="btn-group-toggle" data-toggle="buttons">
                                        {% for ora in ore %}
                                            <label class="btn btn-outline-primary inactive my-1" style="min-width: 70px;" id="{{ ora }}">
                                                <input type="radio" checked autocomplete="off"> {{ ora }}
                                                <!-- SE ESISTE PRENOTAZIONE DI MEZZ'ORA CONTROLLARE CON IF E FARE APPEND BOTTONE CAMBIO ORA-->
                                            </label>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="row align-items-center my-4">
                    <div class="col-md-4 text-left">
                        <input type="reset" class="btn btn-outline-danger" value="Annulla selezione"/>
                    </div>
                    <div class="col-md-6 text-right mb-0">
                        <h5 class="align-bottom mb-0">Totale: <span id="totalCost">0.00</span>€</h5>
                    </div>
                    <div class="col-md-2 text-right">
                        <button type="submit" class="btn btn-outline-success">
                            <strong>Prenota </strong><i class="bi bi-calendar2-check"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </section>


    <!-- Modifica delle frecce del carousel in scuro -->
    <style>
        .carousel-control-next,
        .carousel-control-prev,
        .carousel-indicators {
            filter: invert(100%);
        }
    </style>

    <!-- Script per modificare il prezzo totale in base alla scelta della durata -->
    <script>
        document.getElementById('selectDuration').addEventListener('change', function() {
            var duration = this.value; // Get the selected service duration in minutes

            if (duration) { // Check if a valid option is selected
                var costPerHour = {{ object.prezzi }}; // Let's assume the service costs $50 per hour

                // Convert duration to hours and calculate total cost
                var totalCost = (duration / 60) * costPerHour;

                // Update the total cost in the HTML
                document.getElementById('totalCost').innerText = totalCost.toFixed(2);
            } else {
                // Reset the total cost if no valid option is selected
                document.getElementById('totalCost').innerText = '0.00';
            }
        });
    </script>

    <!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#check-orari').click(function(){
                var campoId = $('#id_campo').val();
                var data = $('#id_data').val();
                var durata = $('#id_durata').val();

                if (campoId && data) {
                    $.ajax({
                        url: '',
                        data: {
                            'campo_id': campoId,
                            'data': data
                        },
                        success: function(response) {
                            $('.orario').each(function(){
                                var hour = $(this).data('hour');
                                var isAvailable = true;

                                // Controlla se l'orario è prenotato
                                $.each(response.orari_prenotati, function(index, prenotazione){
                                    if (hour >= prenotazione.ora_inizio && hour < prenotazione.ora_fine) {
                                        isAvailable = false;
                                    }
                                });

                                if (!isAvailable) {
                                    $(this).removeClass('btn-outline-primary').addClass('btn-danger').prop('disabled', true);
                                } else {
                                    $(this).removeClass('btn-danger').addClass('btn-outline-primary').prop('disabled', false);
                                }
                            });
                        }
                    });
                } else {
                    alert('Seleziona un campo e una data.');
                }
            });
        });

        success: function(response) {
            var durata = parseInt($('#id_durata').val());

            $('.orario').each(function(){
                var hour = parseInt($(this).data('hour'));
                var isAvailable = true;

                // Controlla se l'orario è prenotato
                $.each(response.orari_prenotati, function(index, prenotazione){
                    var ora_inizio = parseInt(prenotazione.ora_inizio.split(':')[0]);
                    var ora_fine = parseInt(prenotazione.ora_fine.split(':')[0]);

                    if (hour >= ora_inizio && hour < ora_fine) {
                        isAvailable = false;
                    }
                });

                // Verifica se ci sono abbastanza ore disponibili per la durata
                for (var i = 0; i < durata; i++) {
                    if ($('.orario[data-hour="' + (hour + i) + ':00"]').prop('disabled') === true) {
                        isAvailable = false;
                        break;
                    }
                }

                if (!isAvailable) {
                    $(this).removeClass('btn-outline-primary').addClass('btn-danger').prop('disabled', true);
                } else {
                    $(this).removeClass('btn-danger').addClass('btn-outline-primary').prop('disabled', false);
                }
            });
        }
    </script>
    -->

{% endblock %}

